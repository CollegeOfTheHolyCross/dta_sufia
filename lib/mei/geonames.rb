require 'uri'

module Mei
  class Geonames

    include Mei::WebServiceBase

    def get_json(url)
      #r = RestClient.get url, {:params => {:featureClass => 'P', :style => 'full', :maxRows => 20, :name_startsWith => "Boston", :username=>"boston_library"}, accept: :json}
      #FIXME: Mocked for testing Geonames
      r = "{\"totalResultsCount\":74,\"geonames\":[{\"timezone\":{\"gmtOffset\":-5,\"timeZoneId\":\"America/New_York\",\"dstOffset\":-4},\"bbox\":{\"east\":-70.748802,\"south\":42.22788,\"north\":42.40082,\"west\":-71.191155},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":29.44562530517578,\"adminId2\":\"4952349\",\"countryCode\":\"US\",\"adminId1\":\"6254926\",\"lat\":\"42.35843\",\"fcode\":\"PPLA\",\"continentCode\":\"NA\",\"elevation\":14,\"adminCode2\":\"025\",\"adminCode1\":\"MA\",\"lng\":\"-71.05977\",\"geonameId\":4930956,\"toponymName\":\"Boston\",\"population\":617594,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"\xD8\xA8\xD9\x88\xD8\xB3\xD8\xB7\xD9\x86\",\"lang\":\"ar\"},{\"name\":\"\xDC\x92\xDC\x98\xDC\xA3\xDC\x9B\xDC\x98\xDC\xA2\",\"lang\":\"arc\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ba\"},{\"name\":\"\xD0\x93\xD0\xBE\xD1\x80\xD0\xB0\xD0\xB4 \xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xB0\xD0\xBD\",\"lang\":\"be\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD1\x8A\xD0\xBD\",\"lang\":\"bg\"},{\"name\":\"\xE0\xA6\xAC\xE0\xA6\xB8\xE0\xA7\x8D\xE0\xA6\x9F\xE0\xA6\xA8\",\"lang\":\"bn\"},{\"name\":\"\xE0\xBD\x96\xE0\xBD\xBC\xE0\xBC\x8B\xE0\xBD\xA6\xE0\xBD\xBA\xE0\xBC\x8B\xE0\xBD\x8A\xE0\xBD\xBC\xE0\xBD\x93\xE0\xBC\x8D\",\"lang\":\"bo\"},{\"name\":\"Boston\",\"lang\":\"ca\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ce\"},{\"name\":\"\xD8\xA8\xDB\x86\xD8\xB3\xD8\xAA\xD9\x86\",\"lang\":\"ckb\"},{\"name\":\"Boston\",\"lang\":\"cs\"},{\"name\":\"Boston\",\"lang\":\"da\"},{\"name\":\"Boston\",\"lang\":\"de\"},{\"name\":\"\xCE\x92\xCE\xBF\xCF\x83\xCF\x84\xCF\x89\xCE\xBD\xCE\xB7\",\"lang\":\"el\"},{\"name\":\"Boston\",\"lang\":\"en\"},{\"name\":\"Bostono\",\"lang\":\"eo\"},{\"name\":\"Boston\",\"lang\":\"es\"},{\"name\":\"Boston\",\"lang\":\"et\"},{\"name\":\"Boston\",\"lang\":\"eu\"},{\"name\":\"\xD8\xA8\xD9\x88\xD8\xB3\xD8\xAA\xD9\x88\xD9\x86\xD8\x8C \xD9\x85\xD8\xA7\xD8\xB3\xD8\xA7\xDA\x86\xD9\x88\xD8\xB3\xD8\xAA\",\"lang\":\"fa\"},{\"name\":\"Boston\",\"lang\":\"fi\"},{\"name\":\"Boston\",\"lang\":\"fr\"},{\"name\":\"Bost\xC3\xBAn\",\"lang\":\"ga\"},{\"name\":\"\xE6\xB3\xA2\xE5\xA3\xAB\xE9\xA0\x93\",\"lang\":\"gan\"},{\"name\":\"Boston\",\"lang\":\"gl\"},{\"name\":\"Pokekona\",\"lang\":\"haw\"},{\"name\":\"\xD7\x91\xD7\x95\xD7\xA1\xD7\x98\xD7\x95\xD7\x9F\",\"lang\":\"he\"},{\"name\":\"\xE0\xA4\xAC\xE0\xA5\x8B\xE0\xA4\xB8\xE0\xA5\x8D\xE0\xA4\x9F\xE0\xA4\xA8\",\"lang\":\"hi\"},{\"name\":\"Boston\",\"lang\":\"hu\"},{\"name\":\"\xD4\xB2\xD5\xB8\xD5\xBD\xD5\xBF\xD5\xB8\xD5\xB6\",\"lang\":\"hy\"},{\"name\":\"BOS\",\"lang\":\"iata\"},{\"name\":\"Boston\",\"lang\":\"id\"},{\"name\":\"Boston\",\"lang\":\"io\"},{\"name\":\"Boston\",\"lang\":\"is\"},{\"name\":\"Boston\",\"lang\":\"it\"},{\"name\":\"\xE3\x83\x9C\xE3\x82\xB9\xE3\x83\x88\xE3\x83\xB3\",\"lang\":\"ja\"},{\"name\":\"\xE1\x83\x91\xE1\x83\x9D\xE1\x83\xA1\xE1\x83\xA2\xE1\x83\x9D\xE1\x83\x9C\xE1\x83\x98\",\"lang\":\"ka\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"kk\"},{\"name\":\"\xE0\xB2\xAC\xE0\xB2\xBE\xE0\xB2\xB8\xE0\xB3\x8D\xE0\xB2\x9F\xE0\xB2\xA8\xE0\xB3\x8D\",\"lang\":\"kn\"},{\"name\":\"\xEB\xB3\xB4\xEC\x8A\xA4\xED\x84\xB4\",\"lang\":\"ko\"},{\"name\":\"Bostonia\",\"lang\":\"la\"},{\"name\":\"http://en.wikipedia.org/wiki/Boston\",\"lang\":\"link\"},{\"name\":\"Bostonas\",\"lang\":\"lt\"},{\"name\":\"Bostona\",\"lang\":\"lv\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"mk\"},{\"name\":\"\xE0\xB4\xAC\xE0\xB5\x8B\xE0\xB4\xB8\xE0\xB5\x8D\xE0\xB4\xB1\xE0\xB5\x8D\xE0\xB4\xB1\xE0\xB5\xBA\",\"lang\":\"ml\"},{\"name\":\"\xE0\xA4\xAC\xE0\xA5\x89\xE0\xA4\xB8\xE0\xA5\x8D\xE0\xA4\x9F\xE0\xA4\xA8\",\"lang\":\"mr\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"mrj\"},{\"name\":\"\xE1\x80\x98\xE1\x80\xB1\xE1\x80\xAC\xE1\x80\xB7\xE1\x80\x85\xE1\x80\x90\xE1\x80\xBD\xE1\x80\x94\xE1\x80\xBA\xE1\x80\x99\xE1\x80\xBC\xE1\x80\xAD\xE1\x80\xAF\xE1\x80\xB7\",\"lang\":\"my\"},{\"name\":\"\xE0\xA4\xAC\xE0\xA4\xB8\xE0\xA5\x8D\xE0\xA4\xA4\xE0\xA4\xA8\",\"lang\":\"new\"},{\"name\":\"Boston\",\"lang\":\"nl\"},{\"name\":\"Boston\",\"lang\":\"no\"},{\"name\":\"Boston\",\"lang\":\"oc\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"os\"},{\"name\":\"\xE0\xA8\xAC\xE0\xA9\x8B\xE0\xA8\xB8\xE0\xA8\x9F\xE0\xA8\xA8\",\"lang\":\"pa\"},{\"name\":\"Boston\",\"lang\":\"pl\"},{\"name\":\"\xD8\xA8\xD9\x88\xD8\xB3\xD9\xB9\xD9\x86\",\"lang\":\"pnb\"},{\"name\":\"\xCE\x92\xCE\xBF\xCF\x83\xCF\x84\xCF\x8E\xCE\xBD\xCE\xB7\",\"lang\":\"pnt\"},{\"name\":\"02112\",\"lang\":\"post\"},{\"name\":\"Boston\",\"lang\":\"pt\"},{\"name\":\"Boston\",\"lang\":\"ro\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"sah\"},{\"name\":\"Bostons\",\"lang\":\"sgs\"},{\"name\":\"Boston\",\"lang\":\"sk\"},{\"name\":\"Boston\",\"lang\":\"sl\"},{\"name\":\"Boston\",\"lang\":\"sq\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"sr\"},{\"name\":\"Boston\",\"lang\":\"sv\"},{\"name\":\"\xE0\xAE\xAA\xE0\xAE\xBE\xE0\xAE\xB8\xE0\xAF\x8D\xE0\xAE\x9F\xE0\xAE\xA9\xE0\xAF\x8D\",\"lang\":\"ta\"},{\"name\":\"\xE0\xB0\xAC\xE0\xB1\x8B\xE0\xB0\xB8\xE0\xB1\x8D\xE0\xB0\x9F\xE0\xB0\xA8\xE0\xB1\x8D\",\"lang\":\"te\"},{\"name\":\"\xE0\xB8\x9A\xE0\xB8\xAD\xE0\xB8\xAA\xE0\xB8\x95\xE0\xB8\xB1\xE0\xB8\x99\",\"lang\":\"th\"},{\"name\":\"Boston\",\"lang\":\"tr\"},{\"name\":\"\xD8\xA8\xD9\x88\xD8\xB3\xD8\xAA\xD9\x88\xD9\x86\",\"lang\":\"ug\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"uk\"},{\"name\":\"BOS\",\"lang\":\"unlc\"},{\"name\":\"\xD8\xA8\xD9\x88\xD8\xB3\xD9\xB9\xD9\x86\",\"lang\":\"ur\"},{\"name\":\"Boston\",\"lang\":\"vi\"},{\"name\":\"\xE6\xB3\xA2\xE5\xA3\xAB\xE9\xA1\xBF\",\"lang\":\"wuu\"},{\"name\":\"\xE1\x83\x91\xE1\x83\x9D\xE1\x83\xA1\xE1\x83\x97\xE1\x83\x9D\xE1\x83\x9C\xE1\x83\x98\",\"lang\":\"xmf\"},{\"name\":\"\xD7\x91\xD7\x90\xD7\xA1\xD7\x98\xD7\x90\xD7\x9F\",\"lang\":\"yi\"},{\"name\":\"\xE6\xB3\xA2\xE5\xA3\xAB\xE9\xA0\x93\",\"lang\":\"yue\"},{\"name\":\"\xE6\xB3\xA2\xE5\xA3\xAB\xE9\xA1\xBF\",\"lang\":\"zh\"},{\"name\":\"\xE6\xB3\xA2\xE5\xA3\xAB\xE9\xA1\xBF\",\"lang\":\"zh-CN\"}],\"adminName2\":\"Suffolk County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"seat of a first-order administrative division\",\"adminName1\":\"Massachusetts\"},{\"timezone\":{\"gmtOffset\":0,\"timeZoneId\":\"Europe/London\",\"dstOffset\":1},\"bbox\":{\"east\":0.013594672814714263,\"south\":52.9521186324655,\"north\":53.00055091320941,\"west\":-0.06688338240155917},\"asciiName\":\"Boston\",\"countryId\":\"2635167\",\"fcl\":\"P\",\"score\":29.102014541625977,\"adminId2\":\"2644486\",\"adminId3\":\"7290588\",\"countryCode\":\"GB\",\"adminId1\":\"6269131\",\"lat\":\"52.97633\",\"fcode\":\"PPL\",\"continentCode\":\"EU\",\"adminCode2\":\"H7\",\"adminCode3\":\"32UB\",\"adminCode1\":\"ENG\",\"lng\":\"-0.02664\",\"geonameId\":2655138,\"toponymName\":\"Boston\",\"population\":35859,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"Boston District\",\"alternateNames\":[{\"name\":\"\xD8\xA8\xD9\x88\xD8\xB3\xD8\xB7\xD9\x86\",\"lang\":\"ar\"},{\"name\":\"Boston\",\"lang\":\"de\"},{\"name\":\"Boston\",\"lang\":\"en\"},{\"name\":\"Boston\",\"lang\":\"eo\"},{\"name\":\"Boston\",\"lang\":\"fr\"},{\"name\":\"\xE3\x83\x9C\xE3\x82\xB9\xE3\x83\x88\xE3\x83\xB3\",\"lang\":\"ja\"},{\"name\":\"\xEB\xB3\xB4\xEC\x8A\xA4\xED\x84\xB4\",\"lang\":\"ko\"},{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Lincolnshire\",\"lang\":\"link\"},{\"name\":\"Boston\",\"lang\":\"nl\"},{\"name\":\"Boston i England\",\"lang\":\"nn\"},{\"name\":\"Boston\",\"lang\":\"no\"},{\"name\":\"Boston\",\"lang\":\"pl\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"},{\"name\":\"Boston\",\"lang\":\"sv\"},{\"name\":\"BOS\",\"lang\":\"unlc\"}],\"adminName2\":\"Lincolnshire\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United Kingdom\",\"fcodeName\":\"populated place\",\"adminName1\":\"England\"},{\"timezone\":{\"gmtOffset\":8,\"timeZoneId\":\"Asia/Manila\",\"dstOffset\":8},\"bbox\":{\"east\":126.37058675330721,\"south\":7.864751629980488,\"north\":7.877470570019512,\"west\":126.35774664669279},\"asciiName\":\"Boston\",\"countryId\":\"1694008\",\"fcl\":\"P\",\"score\":29.102014541625977,\"adminId2\":\"1715342\",\"countryCode\":\"PH\",\"adminId1\":\"7521309\",\"lat\":\"7.87111\",\"fcode\":\"PPL\",\"continentCode\":\"AS\",\"adminCode2\":\"26\",\"adminCode1\":\"11\",\"lng\":\"126.36417\",\"geonameId\":1723862,\"toponymName\":\"Boston\",\"population\":2891,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Davao_Oriental\",\"lang\":\"link\"}],\"adminName2\":\"Davao Oriental\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"Philippines\",\"fcodeName\":\"populated place\",\"adminName1\":\"Davao\"},{\"timezone\":{\"gmtOffset\":-5,\"timeZoneId\":\"America/New_York\",\"dstOffset\":-4},\"bbox\":{\"east\":-83.777206,\"south\":30.780984,\"north\":30.80305,\"west\":-83.802599},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":29.102014541625977,\"adminId2\":\"4226286\",\"countryCode\":\"US\",\"adminId1\":\"4197000\",\"lat\":\"30.79186\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":63,\"adminCode2\":\"275\",\"adminCode1\":\"GA\",\"lng\":\"-83.78989\",\"geonameId\":4183849,\"toponymName\":\"Boston\",\"population\":1315,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Georgia\",\"lang\":\"link\"},{\"name\":\"31626\",\"lang\":\"post\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"},{\"name\":\"BZD\",\"lang\":\"unlc\"}],\"adminName2\":\"Thomas County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Georgia\"},{\"timezone\":{\"gmtOffset\":0,\"timeZoneId\":\"Europe/Dublin\",\"dstOffset\":1},\"bbox\":{\"east\":-8.930171479719817,\"south\":53.029933635124856,\"north\":53.03173236487515,\"west\":-8.933162520280181},\"asciiName\":\"Boston\",\"countryId\":\"2963597\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"2965479\",\"countryCode\":\"IE\",\"adminId1\":\"7521315\",\"lat\":\"53.03083\",\"fcode\":\"PPL\",\"continentCode\":\"EU\",\"adminCode2\":\"03\",\"adminCode1\":\"M\",\"lng\":\"-8.93167\",\"geonameId\":2966053,\"toponymName\":\"Boston\",\"population\":570,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_County_Clare\",\"lang\":\"link\"}],\"adminName2\":\"Co Clare\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"Ireland\",\"fcodeName\":\"populated place\",\"adminName1\":\"Munster\"},{\"timezone\":{\"gmtOffset\":-5,\"timeZoneId\":\"America/New_York\",\"dstOffset\":-4},\"bbox\":{\"east\":-79.82192293987733,\"south\":40.31111473512485,\"north\":40.312913464875145,\"west\":-79.82428186012267},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"5178040\",\"countryCode\":\"US\",\"adminId1\":\"6254927\",\"lat\":\"40.31201\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":232,\"adminCode2\":\"003\",\"adminCode1\":\"PA\",\"lng\":\"-79.8231\",\"geonameId\":5181238,\"toponymName\":\"Boston\",\"population\":545,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Pennsylvania\",\"lang\":\"link\"}],\"adminName2\":\"Allegheny County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Pennsylvania\"},{\"timezone\":{\"gmtOffset\":-5,\"timeZoneId\":\"America/New_York\",\"dstOffset\":-4},\"bbox\":{\"east\":-75.820985,\"south\":37.584939,\"north\":37.621725,\"west\":-75.863891},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"4743865\",\"countryCode\":\"US\",\"adminId1\":\"6254928\",\"lat\":\"37.6093\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":6,\"adminCode2\":\"001\",\"adminCode1\":\"VA\",\"lng\":\"-75.84271\",\"geonameId\":4748439,\"toponymName\":\"Boston\",\"population\":504,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Accomack_County%2C_Virginia\",\"lang\":\"link\"}],\"adminName2\":\"Accomack County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Virginia\"},{\"timezone\":{\"gmtOffset\":-5,\"timeZoneId\":\"America/New_York\",\"dstOffset\":-4},\"bbox\":{\"east\":-85.67159936446927,\"south\":37.78666363512485,\"north\":37.788462364875144,\"west\":-85.67387543553073},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"4302277\",\"countryCode\":\"US\",\"adminId1\":\"6254925\",\"lat\":\"37.78756\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":140,\"adminCode2\":\"179\",\"adminCode1\":\"KY\",\"lng\":\"-85.67274\",\"geonameId\":4285208,\"toponymName\":\"Boston\",\"population\":266,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Kentucky\",\"lang\":\"link\"},{\"name\":\"40107\",\"lang\":\"post\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"}],\"adminName2\":\"Nelson County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Kentucky\"},{\"timezone\":{\"gmtOffset\":2,\"timeZoneId\":\"Africa/Johannesburg\",\"dstOffset\":2},\"bbox\":{\"east\":29.967701728842798,\"south\":-29.667566064875142,\"north\":-29.66576733512486,\"west\":29.965631671157205},\"asciiName\":\"Boston\",\"countryId\":\"953987\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"8347364\",\"adminId3\":\"8347625\",\"countryCode\":\"ZA\",\"adminId1\":\"972062\",\"lat\":\"-29.66667\",\"fcode\":\"PPL\",\"continentCode\":\"AF\",\"elevation\":1451,\"adminCode2\":\"DC22\",\"adminCode3\":\"KZN224\",\"adminCode1\":\"02\",\"lng\":\"29.96667\",\"geonameId\":1016800,\"toponymName\":\"Boston\",\"population\":207,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"Impendle\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_KwaZulu-Natal\",\"lang\":\"link\"}],\"adminName2\":\"uMgungundlovu District Municipality\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"South Africa\",\"fcodeName\":\"populated place\",\"adminName1\":\"KwaZulu-Natal\"},{\"timezone\":{\"gmtOffset\":-5,\"timeZoneId\":\"America/Indiana/Indianapolis\",\"dstOffset\":-4},\"bbox\":{\"east\":-84.85073376895045,\"south\":39.74026073512483,\"north\":39.742059464875176,\"west\":-84.85307303104955},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"4266673\",\"countryCode\":\"US\",\"adminId1\":\"4921868\",\"lat\":\"39.74116\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":345,\"adminCode2\":\"177\",\"adminCode1\":\"IN\",\"lng\":\"-84.8519\",\"geonameId\":4254810,\"toponymName\":\"Boston\",\"population\":138,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Indiana\",\"lang\":\"link\"},{\"name\":\"47324\",\"lang\":\"post\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"}],\"adminName2\":\"Wayne County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Indiana\"},{\"timezone\":{\"gmtOffset\":-3,\"timeZoneId\":\"America/Paramaribo\",\"dstOffset\":-3},\"bbox\":{\"east\":-55.348881663512586,\"south\":5.681904351248573,\"north\":5.699891648751427,\"west\":-55.366958336487414},\"asciiName\":\"Boston\",\"countryId\":\"3382998\",\"fcl\":\"P\",\"score\":23.419055938720703,\"countryCode\":\"SR\",\"adminId1\":\"3383337\",\"lat\":\"5.6909\",\"fcode\":\"PPL\",\"continentCode\":\"SA\",\"adminCode1\":\"15\",\"lng\":\"-55.35792\",\"geonameId\":3384518,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Suriname\",\"lang\":\"link\"}],\"adminName2\":\"\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"Suriname\",\"fcodeName\":\"populated place\",\"adminName1\":\"Para\"},{\"timezone\":{\"gmtOffset\":-6,\"timeZoneId\":\"America/Chicago\",\"dstOffset\":-5},\"bbox\":{\"east\":-87.02140854802586,\"south\":35.83385045124857,\"north\":35.85183774875143,\"west\":-87.04360045197414},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"4668054\",\"countryCode\":\"US\",\"adminId1\":\"4662168\",\"lat\":\"35.84284\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":222,\"adminCode2\":\"187\",\"adminCode1\":\"TN\",\"lng\":\"-87.0325\",\"geonameId\":4607849,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Tennessee\",\"lang\":\"link\"}],\"adminName2\":\"Williamson County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Tennessee\"},{\"timezone\":{\"gmtOffset\":-6,\"timeZoneId\":\"America/Chicago\",\"dstOffset\":-5},\"bbox\":{\"east\":-94.27056749929383,\"south\":37.403834751248574,\"north\":37.42182204875143,\"west\":-94.29321630070618},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"4375904\",\"countryCode\":\"US\",\"adminId1\":\"4398678\",\"lat\":\"37.41283\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":287,\"adminCode2\":\"011\",\"adminCode1\":\"MO\",\"lng\":\"-94.28189\",\"geonameId\":4377987,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Missouri\",\"lang\":\"link\"}],\"adminName2\":\"Barton County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Missouri\"},{\"timezone\":{\"gmtOffset\":-6,\"timeZoneId\":\"America/Chicago\",\"dstOffset\":-5},\"bbox\":{\"east\":-92.04530577296629,\"south\":29.87426925124857,\"north\":29.892256548751426,\"west\":-92.0660532270337},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"4344530\",\"countryCode\":\"US\",\"adminId1\":\"4331987\",\"lat\":\"29.88326\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":2,\"adminCode2\":\"113\",\"adminCode1\":\"LA\",\"lng\":\"-92.05568\",\"geonameId\":4317656,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Louisiana\",\"lang\":\"link\"}],\"adminName2\":\"Vermilion Parish\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Louisiana\"},{\"timezone\":{\"gmtOffset\":-6,\"timeZoneId\":\"America/Chicago\",\"dstOffset\":-5},\"bbox\":{\"east\":-94.40886613101448,\"south\":33.43251495124857,\"north\":33.45050224875143,\"west\":-94.43042426898553},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"4675805\",\"countryCode\":\"US\",\"adminId1\":\"4736286\",\"lat\":\"33.44151\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":111,\"adminCode2\":\"037\",\"adminCode1\":\"TX\",\"lng\":\"-94.41965\",\"geonameId\":4675742,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_Texas\",\"lang\":\"link\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"},{\"name\":\"OWQ\",\"lang\":\"unlc\"}],\"adminName2\":\"Bowie County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Texas\"},{\"timezone\":{\"gmtOffset\":-5,\"timeZoneId\":\"America/New_York\",\"dstOffset\":-4},\"bbox\":{\"east\":-78.72530343210175,\"south\":42.61995585124857,\"north\":42.637943148751425,\"west\":-78.74975436789825},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":23.419055938720703,\"adminId2\":\"5116642\",\"countryCode\":\"US\",\"adminId1\":\"5128638\",\"lat\":\"42.62895\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":287,\"adminCode2\":\"029\",\"adminCode1\":\"NY\",\"lng\":\"-78.73753\",\"geonameId\":5109797,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"http://en.wikipedia.org/wiki/Boston%2C_New_York\",\"lang\":\"link\"},{\"name\":\"14025\",\"lang\":\"post\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"},{\"name\":\"YBS\",\"lang\":\"unlc\"}],\"adminName2\":\"Erie County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"New York\"},{\"timezone\":{\"gmtOffset\":6,\"timeZoneId\":\"Asia/Bishkek\",\"dstOffset\":6},\"bbox\":{\"east\":73.25326563762418,\"south\":40.820602351248574,\"north\":40.83858964875143,\"west\":73.22949036237581},\"asciiName\":\"Boston\",\"countryId\":\"1527747\",\"fcl\":\"P\",\"score\":23.419055938720703,\"countryCode\":\"KG\",\"adminId1\":\"1346798\",\"lat\":\"40.8296\",\"fcode\":\"PPL\",\"continentCode\":\"AS\",\"adminCode1\":\"08\",\"lng\":\"73.24138\",\"geonameId\":8174028,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ky\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"}],\"adminName2\":\"\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"Kyrgyzstan\",\"fcodeName\":\"populated place\",\"adminName1\":\"Osh\"},{\"timezone\":{\"gmtOffset\":6,\"timeZoneId\":\"Asia/Bishkek\",\"dstOffset\":6},\"bbox\":{\"east\":72.46366535358025,\"south\":41.029806351248574,\"north\":41.04779364875143,\"west\":72.43981464641975},\"asciiName\":\"Boston\",\"countryId\":\"1527747\",\"fcl\":\"P\",\"score\":23.419055938720703,\"countryCode\":\"KG\",\"adminId1\":\"1529778\",\"lat\":\"41.0388\",\"fcode\":\"PPL\",\"continentCode\":\"AS\",\"adminCode1\":\"03\",\"lng\":\"72.45174\",\"geonameId\":8135699,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ky\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"}],\"adminName2\":\"\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"Kyrgyzstan\",\"fcodeName\":\"populated place\",\"adminName1\":\"Jalal-Abad\"},{\"timezone\":{\"gmtOffset\":6,\"timeZoneId\":\"Asia/Bishkek\",\"dstOffset\":6},\"bbox\":{\"east\":72.97442105905563,\"south\":41.006096351248246,\"north\":41.024083648751756,\"west\":72.95057894094438},\"asciiName\":\"Boston\",\"countryId\":\"1527747\",\"fcl\":\"P\",\"score\":23.419055938720703,\"countryCode\":\"KG\",\"adminId1\":\"1529778\",\"lat\":\"41.01509\",\"fcode\":\"PPL\",\"continentCode\":\"AS\",\"adminCode1\":\"03\",\"lng\":\"72.9625\",\"geonameId\":1527576,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ky\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"}],\"adminName2\":\"\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"Kyrgyzstan\",\"fcodeName\":\"populated place\",\"adminName1\":\"Jalal-Abad\"},{\"timezone\":{\"gmtOffset\":-5,\"timeZoneId\":\"America/New_York\",\"dstOffset\":-4},\"bbox\":{\"east\":-78.12016632784601,\"south\":38.531963651248574,\"north\":38.54995094875143,\"west\":-78.14316607215399},\"asciiName\":\"Boston\",\"countryId\":\"6252001\",\"fcl\":\"P\",\"score\":22.123830795288086,\"adminId2\":\"4754972\",\"countryCode\":\"US\",\"adminId1\":\"6254928\",\"lat\":\"38.54096\",\"fcode\":\"PPL\",\"continentCode\":\"NA\",\"elevation\":165,\"adminCode2\":\"047\",\"adminCode1\":\"VA\",\"lng\":\"-78.13167\",\"geonameId\":4748440,\"toponymName\":\"Boston\",\"population\":0,\"adminName5\":\"\",\"adminName4\":\"\",\"adminName3\":\"\",\"alternateNames\":[{\"name\":\"22713\",\"lang\":\"post\"},{\"name\":\"\xD0\x91\xD0\xBE\xD1\x81\xD1\x82\xD0\xBE\xD0\xBD\",\"lang\":\"ru\"}],\"adminName2\":\"Culpeper County\",\"name\":\"Boston\",\"fclName\":\"city, village,...\",\"countryName\":\"United States\",\"fcodeName\":\"populated place\",\"adminName1\":\"Virginia\"}]}"
      JSON.parse(r)

      #result["geonames"].first["name"]
      #result["geonames"].first["geonameId"]
      #bbox
      #adminId1
      #adminId2
    end

    def request_options
      {:params => {:featureClass => 'P', :style => 'full', :maxRows => 20, :name_startsWith => "#{@escaped_query}", :username=>"boston_library"}, accept: :json}
    end

    def initialize
    end

    def search q
      @raw_response = get_json(build_query_url(q))
      parse_authority_response
    end


    def build_query_url q
      @escaped_query = URI.escape(q)
      return "http://ws.geonames.org/searchJSON"
    end


    #result["geonames"].first["name"]
    #result["geonames"].first["geonameId"]
    #bbox
    #adminId1
    #adminId2
    def parse_authority_response
      end_response = []
      count = 0
      @raw_response["geonames"].each do |geoname|

        end_response << {
            "uri_link" => geoname["geonameId"] || "missing!",
            "label" => geoname["name"],
            "broader" => broader(geoname),
            "narrower" => narrower(geoname),
            "variants" => variants(geoname),
            "count" => count
        }
      end

      end_response
    end



    def broader(row)
      broader_list = []
      broader_list << {:uri_link=>row["adminId1"], :label=>row["adminName1"]} if row["adminId1"].present? && row["adminName1"].present?
      broader_list << {:uri_link=>row["adminId2"], :label=>row["adminName2"]} if row["adminId2"].present? && row["adminName2"].present?
      broader_list << {:uri_link=>row["countryId"], :label=>row["countryName"]} if row["countryId"].present? && row["countryName"].present?

      return broader_list
    end

    def narrower(row)
      return []
    end

    def variants(row)
      varient_list = []
      row["alternateNames"].each do |variant|
        #if ['eng'].include?( variant["lang"])
          varient_list <<  variant["name"]
        #end
      end
     return varient_list
    end


    def solr_clean(term)
      return term.gsub('\\', '\\\\').gsub(':', '\\:').gsub(' ', '\ ')
    end


  end
end